{% extends "base.html" %}

{% block title %}Lista de Usuarios{% endblock %}

{% block content %}
<style>
  .user-card {
    border: 1px solid #dbdbdb;
    border-radius: 6px;
    padding: 1.5rem;
  }
</style>
<div class="container mt-6">
  <h1 class="title is-5 has-text-centered">¡Usuarios Registrados!</h1>

  <div class="field">
    <div class="control has-icons-left">
      <input id="search-input" class="input is-rounded is-medium" type="text" placeholder="Buscar por cualquier criterio...">
      <span class="icon is-left">
        <i class="fas fa-search"></i>
      </span>
    </div>
  </div>

  <div id="users-container" class="columns is-multiline is-mobile is-centered is-hidden-980">
    {% for user in users %}
    <div class="column is-12-mobile is-10-tablet is-4-desktop user-card-column">
      <div class="is-rounded user-card">
        <div class="content">
          <div class="media">
            <div class="media-content">
              <p class="title is-4 has-text-warning">{{ user.nombre }} {{ user.primer_apellido }}</p>
              <p class="subtitle is-6 has-text-grey">@{{ user.usuario }}</p>
            </div>
          </div>
          <div class="content">
            <p><strong>ID:</strong> <span class="user-id">{{ user.id }}</span></p>
            <p><strong>Email:</strong> <span class="user-email">{{ user.email }}</span></p>
            <p><strong>Teléfono:</strong> <span class="user-phone">{{ user.telefono }}</span></p>
            <p><strong>Rol:</strong> <span class="user-rol">{{ user.rol }}</span></p>
            <br>
            <div class="buttons is-centered is-flex is-flex-wrap-nowrap">
              <a href="{{ url_for('editar_usuario', user_id=user.id) }}" class="button is-info is-rounded is-flex-grow-1 is-small">
                <span class="icon"><i class="fas fa-edit"></i></span>
                <span>Editar</span>
              </a>
              <form action="{{ url_for('eliminar_usuario', user_id=user.id) }}" method="POST" style="display:inline;" class="is-flex is-flex-grow-1">
                <button type="submit" class="button is-danger is-rounded is-flex-grow-1 is-small" onclick="return confirm('¿De verdad quieres borrar a este usuario? ¡Piensalo bien!');">
                  <span class="icon"><i class="fas fa-trash-alt"></i></span>
                  <span>Eliminar</span>
                </button>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>

  <table id="users-table" class="table is-striped is-hoverable is-fullwidth is-hidden-980-down">
    <thead>
      <tr>
        <th>ID</th>
        <th>Nombre</th>
        <th>Usuario</th>
        <th>Email</th>
        <th>Teléfono</th>
        <th>Rol</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody>
      {% for user in users %}
      <tr>
        <td>{{ user.id }}</td>
        <td>{{ user.nombre }} {{ user.primer_apellido }}</td>
        <td>{{ user.usuario }}</td>
        <td>{{ user.email }}</td>
        <td>{{ user.telefono }}</td>
        <td>{{ user.rol }}</td>
        <td>
          <div class="buttons is-small">
            <a href="{{ url_for('editar_usuario', user_id=user.id) }}" class="button is-info is-light">
              <span class="icon"><i class="fas fa-edit"></i></span>
              <span>Editar</span>
            </a>
            <form action="{{ url_for('eliminar_usuario', user_id=user.id) }}" method="POST" style="display:inline;">
              <button type="submit" class="button is-danger is-light" onclick="return confirm('¿De verdad quieres borrar a este usuario? ¡Piensalo bien!');">
                <span class="icon"><i class="fas fa-trash-alt"></i></span>
                <span>Eliminar</span>
              </button>
            </form>
          </div>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const searchInput = document.getElementById('search-input');
    const usersTable = document.getElementById('users-table');
    const userCards = document.querySelectorAll('.user-card-column');

    function filterUsers(searchTerm) {
        const filterText = searchTerm.toLowerCase();

        // Filtrar tarjetas
        userCards.forEach(card => {
            const cardContent = card.textContent.toLowerCase();
            if (cardContent.includes(filterText)) {
                card.style.display = 'block';
            } else {
                card.style.display = 'none';
            }
        });

        // Filtrar filas de la tabla
        const tableRows = usersTable.querySelectorAll('tbody tr');
        tableRows.forEach(row => {
            const rowContent = row.textContent.toLowerCase();
            if (rowContent.includes(filterText)) {
                row.style.display = '';
            } else {
                row.style.display = 'none';
            }
        });
    }

    searchInput.addEventListener('input', (event) => {
        filterUsers(event.target.value);
    });

    // Oculta la tabla en móviles y las tarjetas en desktop
    const mediaQuery = window.matchMedia('(max-width: 980px)');
    function handleMediaQuery(e) {
        if (e.matches) {
            usersTable.style.display = 'none';
            document.getElementById('users-container').style.display = 'flex';
        } else {
            usersTable.style.display = 'table';
            document.getElementById('users-container').style.display = 'none';
        }
    }
    mediaQuery.addListener(handleMediaQuery);
    handleMediaQuery(mediaQuery); // Llama a la función al cargar para la configuración inicial
});
</script>
{% endblock %}
